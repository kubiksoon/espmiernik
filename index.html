<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Miernik</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="favicon.ico" />
</head>
<body class="bg-gray-100 text-gray-800 font-sans p-6">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-center mb-8">üå°Ô∏èMiernik Temperatury i Wilgotno≈õci</h1>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <div>
        <canvas id="tempChart"></canvas>
      </div>
      <div>
        <canvas id="humChart"></canvas>
      </div>
    </div>
  </div>

  <script>
    // Dane Firebase
    const FIREBASE_HOST = "bazadanychdostronki-default-rtdb.europe-west1.firebasedatabase.app";
    const FIREBASE_AUTH = "AIzaSyA5Ad-WJKhezBBaPBeWi1KQ1oH3-MVTlm4";

    const firebaseConfig = {
      apiKey: FIREBASE_AUTH,
      authDomain: "bazadanychdostronki.firebaseapp.com",
      databaseURL: `https://${FIREBASE_HOST}`,
      projectId: "bazadanychdostronki",
      storageBucket: "bazadanychdostronki.appspot.com",
      messagingSenderId: "112714680419",
      appId: "1:112714680419:web:1790cbce2c8190a6c95056",
      measurementId: "G-SD3Y75RVT2"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const tempChartCtx = document.getElementById('tempChart').getContext('2d');
    const humChartCtx = document.getElementById('humChart').getContext('2d');

    const labels = [];
    const tempData = [];
    const humData = [];

    const tempChart = new Chart(tempChartCtx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Temperatura (¬∞C)',
          data: tempData,
          borderColor: 'rgb(255, 99, 132)',
          tension: 0.4
        }]
      }
    });

    const humChart = new Chart(humChartCtx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Wilgotno≈õƒá (%)',
          data: humData,
          borderColor: 'rgb(54, 162, 235)',
          tension: 0.4
        }]
      }
    });

    // Funkcja do aktualizacji wykres√≥w
    function updateCharts() {
      db.ref('pomiar').on('value', function(snapshot) {
        if (snapshot.val() != null) {
          const temp = snapshot.val().temp;
          const hum = snapshot.val().wilgotnosc;
          console.log("Dane z Firebase:", temp, hum);  // Sprawdzanie danych
                    
          // Aktualizacja wykres√≥w
          tempData.push(temp);
          humData.push(hum);
          labels.push(new Date().toLocaleTimeString());

          // Je≈õli jest wiƒôcej ni≈º 20 danych, usu≈Ñ najstarsze
          if (tempData.length > 20) {
            tempData.shift();
            humData.shift();
            labels.shift();
          }

          // Aktualizacja wykres√≥w
          tempChart.update();
          humChart.update();
        }
      });
    }

    // Od≈õwie≈ºanie co 10 sekund
    setInterval(updateCharts, 1000);
    updateCharts(); // Uruchomienie funkcji od razu
  </script>
</body>
</html>
